---
alwaysApply: true
---

description: Règles de refactoring inspirées de Martin Fowler pour améliorer la lisibilité, la maintenabilité et la structure du code. À appliquer systématiquement dans Cursor.
globs:

- "\*_/_.ts"
- "\*_/_.tsx"
- "src/\*_/_.ts"
- "src/\*_/_.tsx"

---

# Refactoring Principles — Martin Fowler Style

## 1. Code Smells → Refactor

- Si le code est **dupliqué**, **extraire une fonction** (`extract function`).
- Si une fonction fait **plus d'une chose**, **diviser-la** (`split function`).
- Si une fonction a **trop de paramètres**, **regrouper-les dans un objet** (`introduce parameter object`).
- Si un nom est **ambigu ou trop générique**, **renommer** (`rename variable/function/class`) pour exprimer son intention.
- Si un composant ou module **fait trop de choses**, **extraire un composant/module** (`extract component/module`).

## 2. Simplify Logic

- Préférer les **conditions claires** à des structures complexes.
- **Remplacer les conditions imbriquées** par des retours précoces (`replace nested conditionals with guard clauses`).
- **Supprimer les branches mortes** ou inaccessibles.
- Éviter les **valeurs magiques** : créer des **constantes nommées**.

## 3. Small, Focused Functions

- Une fonction ne doit faire **qu’une seule chose**.
- Une fonction doit tenir dans **une seule vue d’écran** (~15–20 lignes max).
- Nommer selon **le résultat attendu**, pas selon les détails d’implémentation.
- Supprimer les **effets de bord cachés** (toute mutation doit être explicite).

## 4. Cohérence & Clarté

- Les noms doivent refléter **l’intention métier**, pas la technologie.
- Garder la **symétrie** entre noms de variables, composants et fichiers.
- Organiser les fichiers par **fonctionnalité** plutôt que par type (feature-first structure).

## 5. Data Flow & State

- Éviter les **états globaux** non contrôlés.
- Préférer les **valeurs dérivées** calculées à la volée plutôt que stockées inutilement.
- **Supprimer le code mort** (state, props ou imports inutilisés).

## 6. React-Specific Refactor Rules

- Extraire les **hooks personnalisés** pour toute logique réutilisable ou complexe.
- Décomposer les composants >150 lignes.
- Éviter les **useEffect** qui font plusieurs choses — séparer en plusieurs hooks ou effets.
- Supprimer tout **console.log**, **alert** ou **TODO** avant livraison.
- Utiliser `memo` / `useCallback` uniquement si justifié par un vrai problème de performance (mesuré).

## 7. Testing & Safety

- Après chaque refactor, **valider les tests unitaires** et **tests de rendu**.
- Si un test est trop fragile → refactorer le code, pas le test.
- Ajouter des tests pour couvrir les nouveaux comportements après refactor.

## 8. Progressive Improvement

- Un refactor n’est pas une réécriture complète.
- Toujours viser à **améliorer légèrement** la structure sans casser la logique existante.
- Laisser le code **plus clair** que tu ne l’as trouvé.

---
